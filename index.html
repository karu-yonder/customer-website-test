<!DOCTYPE html>
<html>
  <head>
    <script>
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      function validateEnvironment() {
        const env = getQueryParam("env");
        const id = getQueryParam("id");
        const allowedEnvs = ["dev", "staging", "prod"];

        let hasErrors = false;
        const errorMessages = [];

        if (!env || !allowedEnvs.includes(env)) {
          hasErrors = true;
          errorMessages.push({
            title: "Environment Required",
            message:
              "Please add an environment query parameter: ?env=dev, ?env=staging, or ?env=prod",
            background: "#ff6b6b",
          });
        }

        if (!id) {
          hasErrors = true;
          errorMessages.push({
            title: "ID Parameter Required",
            message: "Please add an 'id' query parameter to the URL",
            background: "#ff9500",
          });
        }

        // Always show the form for parameter management
        const container = document.createElement("div");
        container.style.cssText =
          "position: fixed; top: 20px; left: 20px; z-index: 10000; background: rgba(0,0,0,0.9); padding: 20px; border-radius: 12px; color: white; font-family: Arial, sans-serif; min-width: 400px;";

        const title = document.createElement("h3");
        title.textContent =
          env && id ? "Update Parameters" : "Missing Required Parameters";
        title.style.cssText = "margin: 0 0 15px 0; color: white;";
        container.appendChild(title);

        // Environment input - always show
        const envGroup = document.createElement("div");
        envGroup.style.cssText = "margin-bottom: 15px;";

        const envLabel = document.createElement("label");
        envLabel.textContent = "Environment:";
        envLabel.style.cssText =
          "display: block; margin-bottom: 5px; color: white;";
        envGroup.appendChild(envLabel);

        const envSelect = document.createElement("select");
        envSelect.style.cssText =
          "width: 100%; padding: 8px; border-radius: 4px; border: none; margin-bottom: 5px;";
        envSelect.innerHTML = `
          <option value="">Select environment...</option>
          <option value="dev" ${env === "dev" ? "selected" : ""}>dev</option>
          <option value="staging" ${
            env === "staging" ? "selected" : ""
          }>staging</option>
          <option value="prod" ${env === "prod" ? "selected" : ""}>prod</option>
        `;
        envGroup.appendChild(envSelect);

        container.appendChild(envGroup);

        // ID input - always show
        const idGroup = document.createElement("div");
        idGroup.style.cssText = "margin-bottom: 15px;";

        const idLabel = document.createElement("label");
        idLabel.textContent = "ID Parameter:";
        idLabel.style.cssText =
          "display: block; margin-bottom: 5px; color: white;";
        idGroup.appendChild(idLabel);

        const idInput = document.createElement("input");
        idInput.type = "text";
        idInput.placeholder = "Enter ID value...";
        idInput.value = id || "";
        idInput.style.cssText =
          "width: 100%; padding: 8px; border-radius: 4px; border: none; margin-bottom: 5px; box-sizing: border-box;";
        idGroup.appendChild(idInput);

        container.appendChild(idGroup);

        // Update button
        const updateBtn = document.createElement("button");
        updateBtn.textContent =
          env && id ? "Update Parameters" : "Add Parameters";
        updateBtn.style.cssText =
          "background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; width: 100%;";
        updateBtn.onclick = function () {
          const newEnv = container.querySelector("select")?.value || env;
          const newId = container.querySelector("input")?.value || id;

          if (newEnv && newId) {
            const url = new URL(window.location);
            url.searchParams.set("env", newEnv);
            url.searchParams.set("id", newId);
            window.location.href = url.toString();
          } else {
            alert("Please fill in all required fields");
          }
        };
        container.appendChild(updateBtn);

        document.body.appendChild(container);

        // Return validation result for script loading logic
        return hasErrors;
      }

      const idFromUrl = getQueryParam("id") || "21";
      window.YONDER__CLIENT_CODE = idFromUrl;

      function loadWidgetScript() {
        const env = getQueryParam("env");
        let scriptUrl;

        switch (env) {
          case "dev":
            scriptUrl = "https://dev.widget.yonderhq.com/main.js";
            break;
          case "staging":
            scriptUrl = "https://staging.widget.yonderhq.com/main.js";
            break;
          case "prod":
            scriptUrl = "https://widget.yonderhq.com/main.js";
            break;
          default:
            scriptUrl = "https://staging.widget.yonderhq.com/main.js";
        }

        const script = document.createElement("script");
        script.src = scriptUrl;
        document.head.appendChild(script);
      }

      document.addEventListener("DOMContentLoaded", function () {
        validateEnvironment();

        if (getQueryParam("env") && getQueryParam("id")) {
          loadWidgetScript();
        }
      });
    </script>
  </head>
  <body>
    <div
      style="
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
      "
    >
      <button
        onclick="window.location.href='yonderhq.html'"
        style="
          background: #007bff;
          color: white;
          border: none;
          padding: 15px 30px;
          border-radius: 8px;
          cursor: pointer;
          font-size: 16px;
          font-weight: bold;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
          transition: all 0.3s ease;
        "
        onmouseover="this.style.background='#0056b3'; this.style.transform='translate(-50%, -50%) scale(1.05)'"
        onmouseout="this.style.background='#007bff'; this.style.transform='translate(-50%, -50%) scale(1)'"
      >
        Go to YonderHQ
      </button>
    </div>
  </body>
</html>
